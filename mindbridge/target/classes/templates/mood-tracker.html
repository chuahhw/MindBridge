<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mood Tracker</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        .form-control, .form-control:disabled { color:black; }

        body {
            background:#f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height:1.6;
        }

        /* NAVBAR (Header) */
        .navbar {
            background:#1666f2;
            padding:15px 0;
            border-bottom:none;
        }
        .navbar-container {
            max-width:1200px;
            margin:auto;
            padding:0 20px;
            display:flex;
            justify-content:space-between;
            align-items:center;
        }
        .navbar-brand {
            font-weight:600;
            font-size:24px;
            color:#fff;
            text-decoration:none;
        }
        .user-section { display:flex; align-items:center; gap:15px; }
        .username { color:#fff; font-size:14px; font-weight:500; }
        .logout-btn {
            background:#fff;
            color:#1666f2;
            padding:8px 16px;
            border-radius:4px;
            font-weight:600;
            border:none;
            cursor:pointer;
        }
        .logout-btn:hover { background:#f8f9fa; }

        /* MENU TABS */
        .menu-tabs {
            background:#fff;
            border-bottom:1px solid #dee2e6;
            padding:15px 0;
        }
        .tabs-container {
            max-width:1200px;
            margin:auto;
            padding:0 20px;
        }
        .nav-tabs {
            display:flex;
            list-style:none;
            padding:0;
            margin:0;
        }
        .nav-tabs .nav-link {
            padding:15px 20px;
            color:#495057;
            font-weight:500;
            font-size:14px;
            text-decoration:none;
            border:none;
        }
        .nav-tabs .nav-link.active {
            color:#1666f2;
            border-bottom:3px solid #1666f2;
            font-weight:600;
        }
        .nav-tabs .nav-link:hover {
            color:#1666f2;
            background:#f8f9fa;
        }

        /* MAIN CONTENT */
        .main-content {
            max-width:1200px;
            margin:auto;
            padding:30px 20px;
        }

        /* STATS CARDS */
        .stats-container {
            display:grid;
            grid-template-columns:repeat(3,1fr);
            gap:20px;
        }
        .stat-card {
            background:#fff;
            border-radius:12px;
            padding:25px;
            text-align:center;
            box-shadow:0 2px 8px rgba(0,0,0,0.08);
        }
        .stat-label { color:#6c757d; font-size:14px; }
        .stat-value { font-size:32px; font-weight:700; }

        .log-mood-btn {
            margin-top:20px;
            background:#1666f2;
            color:white;
            padding:10px 20px;
            border:none;
            border-radius:4px;
            font-weight:600;
        }

        /* MOOD HISTORY */
        .profile-section {
            background:#fff;
            border-radius:12px;
            padding:30px;
            margin-top:30px;
            box-shadow:0 2px 8px rgba(0,0,0,0.08);
        }
        .mood-entry {
            display:flex;
            justify-content:space-between;
            padding:12px 0;
            border-bottom:1px solid #e9ecef;
        }

        /* MODAL */
        .mood-option {
            cursor:pointer;
            transition:0.2s;
        }
        .mood-option:hover { background:#f0f5ff; }
        .mood-option.selected {
            border:2px solid #1666f2;
            background:#e9f0ff;
        }

        @media (max-width: 768px) {
            .stats-container { grid-template-columns:1fr; }
            .navbar-container {
                padding: 0 15px;
            }
            
            .navbar-brand {
                font-size: 20px;
            }
            
            .tabs-container {
                padding: 0 15px;
                overflow-x: auto;
            }
            
            .nav-tabs {
                flex-wrap: nowrap;
                width: max-content;
            }
            
            .nav-tabs .nav-link {
                padding: 12px 16px;
                font-size: 13px;
                white-space: nowrap;
            }
            
            .main-content {
                padding: 20px 15px;
            }
            
            .profile-header {
                padding: 20px;
                flex-direction: column;
                text-align: center;
            }
            
            .profile-section {
                padding: 20px;
            }
            
            .user-section {
                gap: 10px;
            }
            
            .username {
                font-size: 12px;
            }
            
            .logout-btn {
                padding: 6px 12px;
                font-size: 12px;
            }
        }
    </style>
</head>

<body>
    <!-- Include Header -->
    <div th:replace="~{fragments/header :: header}"></div>
    
    <!-- Include Menu with active page parameter -->
    <div th:replace="~{fragments/menu :: menu('mood-tracker')}"></div>

<!-- MAIN CONTENT -->
<div class="main-content">

    <!-- Stats -->
    <div class="stats-container">
        <div class="stat-card">
            <div class="stat-label">Current Streak</div>
            <div class="stat-value" th:text="${streak}">0</div>
            <div class="stat-subtext">days</div>
        </div>

        <div class="stat-card">
            <div class="stat-label">7-Day Avg</div>
            <div class="stat-value" th:text="${average7Days}">0.0</div>
            <div class="stat-subtext">/5.0</div>
        </div>

        <div class="stat-card">
            <div class="stat-label">Total Entries</div>
            <div class="stat-value" th:text="${totalEntries}">0</div>
            <div class="stat-subtext">entries</div>
        </div>
    </div>

    <!-- Add Mood Button -->
    <div class="text-center">
        <button class="log-mood-btn" onclick="openMoodModal()">
            <i class="fas fa-plus"></i> Log Today's Mood
        </button>
    </div>

    <!-- Mood History -->
    <div class="profile-section">
        <h4>Mood History</h4>

        <div th:each="m : ${moods}" class="mood-entry">
            <div><strong th:text="${m.mood}">Good</strong></div>
            <div th:text="${m.notes}" class="text-muted">A note here</div>
            <div th:text="${m.entryDate}" class="text-muted"></div>
        </div>

        <div th:if="${#lists.isEmpty(moods)}" class="text-muted mt-3">
            No mood entries yet.
        </div>
    </div>

</div>

<!-- MODAL -->
<div class="modal fade" id="moodModal">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content p-4">

            <h5 class="mb-3">How are you feeling?</h5>

            <form method="post" th:action="@{/mood/save}">
                <input type="hidden" name="moodValue" id="moodValueInput">

                <div class="d-grid gap-2" style="grid-template-columns:repeat(3,1fr);">
                    <div class="mood-option p-3 border text-center" onclick="selectMood(this,5)">üòä<br>Great</div>
                    <div class="mood-option p-3 border text-center" onclick="selectMood(this,4)">üôÇ<br>Good</div>
                    <div class="mood-option p-3 border text-center" onclick="selectMood(this,3)">üòê<br>Okay</div>
                    <div class="mood-option p-3 border text-center" onclick="selectMood(this,2)">üòï<br>Not Great</div>
                    <div class="mood-option p-3 border text-center" onclick="selectMood(this,1)">üòû<br>Bad</div>
                    <div class="mood-option p-3 border text-center" onclick="selectMood(this,0)">üò¢<br>Awful</div>
                </div>

                <textarea class="form-control my-3" name="note" placeholder="Add a note..."></textarea>

                <button id="saveMoodBtn" class="btn btn-primary w-100 d-none">Save Mood</button>
            </form>

        </div>
    </div>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    function openMoodModal() {
        document.querySelectorAll('.mood-option').forEach(o=>o.classList.remove('selected'));
        document.getElementById('moodValueInput').value="";
        new bootstrap.Modal(document.getElementById('moodModal')).show();
    }

    function selectMood(el,val){
        document.querySelectorAll('.mood-option').forEach(o=>o.classList.remove('selected'));
        el.classList.add('selected');
        document.getElementById('moodValueInput').value = val;
        document.getElementById('saveMoodBtn').classList.remove('d-none');
    }
</script>

</body>
</html>
